LOG_CHAT    = -10012345678
WORKER_CHAT = -10012345678


from pyrogram import filters, errors
from utils import (
    Cmd, get_group, code, b, bq,
    helplist, Module, Argument as Arg, Feature, Command,
    plural, parse_amout,
    ModifyPyrogramClient as Client,
    make_request
)
import asyncio
from bs4 import BeautifulSoup

cmd = Cmd(G:=get_group())

helplist.add_module(
    Module(
        "MineEvo",
        description="–ú–æ–¥—É–ª—å –¥–ª—è –∏–≥—Ä—ã @mine_evo_bot",
        author="@RimMirK & @kotcananacom",
        version='3.1.0'
    ).add_command(
        Command(['mine'], [], '–í—ã–≤–µ—Å—Ç–∏ —Å–≤–æ–¥–∫—É')
    ).add_command(
        Command(['mdig'], [], '–Ω–∞—á–∏–Ω–∞–µ—Ç –∫–æ–ø–∞—Ç—å')
    ).add_command(
        Command(['mstopdig', 'mnodig', 'mundig'], [], '–ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –∫–æ–ø–∞—Ç—å')
    ).add_command(
        Command(['evo'], [Arg('–∑–∞–ø—Ä–æ—Å/–∫–æ–º–∞–Ω–¥–∞')], '–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å/–∫–æ–º–∞–Ω–¥—É –≤ —Ä–æ–±–æ—á–∏–π —á–∞—Ç –∏ –≤—ã–≤–æ–¥–∏—Ç –æ—Ç–≤–µ—Ç. –ü—Ä–∏–º–µ—Ä: .evo –≤—Ä–µ–º—è')
    ).add_command(
        Command(['bevo'], [Arg('–∑–∞–ø—Ä–æ—Å/–∫–æ–º–∞–Ω–¥–∞')], '–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å/–∫–æ–º–∞–Ω–¥—É –±–æ—Ç—É –≤ –õ–° –∏ –≤—ã–≤–æ–¥–∏—Ç –æ—Ç–≤–µ—Ç. –ü—Ä–∏–º–µ—Ä: .evo –≤—Ä–µ–º—è')
    ).add_command(
        Command(['mprof', '–º–ø—Ä–æ—Ñ'], [], '–í—ã–≤–æ–¥–∏—Ç –ø—Ä–æ—Ñ–∏–ª—å')
    ).add_command(
        Command(['mstat', 'ms', 'mstats', '–º—Å—Ç–∞—Ç–∞', '–º—Å—Ç–∞—Ç', '–º—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'], [],'–í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É')
    ).add_command(
        Command(['mcases', '–º–∫', '–º–∫–µ–π—Å—ã'], [], '–≤—ã–≤–æ–¥–∏—Ç —Ç–≤–æ–∏ –∫–µ–π—Å—ã')
    ).add_command(
        Command(["mopen", "mcase", '–º–æ', '–º–æ—Ç–∫', '–º–æ—Ç–∫—Ä—ã—Ç—å'], [Arg('([—Ç–∏–ø –∫–µ–π—Å–∞] [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]), ..')],'–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–µ–π—Å—ã –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤. –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –∫–µ–π—Å–æ–≤ –ü—Ä–∏–º–µ—Ä—ã: .–æ—Ç–∫ –∫ 36 | .–æ—Ç–∫ –∫—Ç 27 —Ä–∫—Ç 6 –∫ 3 ')
    ).add_command(
        Command(['–º–æ—Ç–∫–ª', 'mopenlim'], [Arg('–∫–æ–ª-–≤–æ')],'–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–æ–≤ –∑–∞ —Ä–∞–∑')
    ).add_command(
        Command(['mdelay'],    [Arg('—Å–µ–∫')], '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–¥–¥–µ—Ä–∂–∫—É –Ω–∞ –∫–æ–ø–∫—É')
    ).add_command(
        Command(['matcdelay'], [Arg('—Å–µ–∫')], '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–¥–¥–µ—Ä–∂–∫—É –Ω–∞ –∞—Ç–∞–∫—É –±–æ—Å—Å–∞')
    ).add_feature(
        Feature('–ê–≤—Ç–æ-–≤—ã–±–æ—Ä–∫–∞ —à–∞—Ö—Ç—ã', '–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–±–æ—Ä–∫–∞ —à–∞—Ö—Ç—ã –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è')
    ).add_feature(
        Feature('Log', '–û—Ç—á–µ—Ç –ø–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–º –∫–µ–π—Å–∞–º, –Ω–∞–π–¥–µ–Ω–Ω—ã–º –±—É—Å—Ç–µ—Ä–∞–º, —É–±–∏—Ç—ã–º –±–æ—Å—Å–∞–º')
    ).add_feature(
        Feature('–ê–≤—Ç–æ –∞—Ç–∞–∫–∞', '–°–∞–º–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –∏ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –∞—Ç–∞–∫–æ–≤–∞—Ç—å –±–æ—Å—Å–∞ –ø—Ä–∏ –µ–≥–æ –≤—ã–±–æ—Ä–µ')
    ).add_feature(
        Feature('–ê–≤—Ç–æ –∞–≤—Ç–æ-–±—É—Ä', '–°–∞–º –∫–∞—á–∞–µ—Ç —Ç–æ–ø–ª–∏–≤–æ –∏ –∑–∞–ø—Ä–∞–≤–ª—è–µ—Ç –±—É—Ä')
    )
)

M = 'MineEVO'

plural_raz = ["—Ä–∞–∑", "—Ä–∞–∑–∞", "—Ä–∞–∑"]


# –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
@Client.on_ready(group=get_group())
async def _on_ready(app, *_):
    ev = asyncio.get_event_loop()

    ev.create_task(digger(app)) # –∫–æ–ø–∞–ª–∫–∞
    ev.create_task(start_autobur(app)) # –∞–≤—Ç–æ–±—É—Ä



# —Å–≤–æ–¥–∫–∞
@cmd(['mine'])  
async def _mine(app, msg):
    c = await app.db.get(M, 'c', 0)
    all_c = await app.db.get(M, 'all_c', 0)
    await msg.edit(
        "–ö–æ–ø–∞—é: " + b(
            '–î–∞ <emoji id="5359300921123683281">‚úÖ</emoji>'
            if await app.db.get(M, 'work', False)
            else '–ù–µ—Ç <emoji id="5359457318062798459">‚ùå</emoji>', False
        ) + '\n'
        f"–í—Å–∫–æ–ø–∞–ª: " + b(f"{c} {plural(c, plural_raz)}") + '\n'
        f"–í—Å–µ–≥–æ –≤—Å–∫–æ–ø–∞–ª: " + b(f"{all_c} {plural(all_c, plural_raz)}") + '\n'
    )


# –∫–æ–ø–∞—Ç–µ–ª—å
async def digger(app):
    while True:
        if await app.db.get(M, 'work', False) == True:
            app.print('–∫–æ–ø')

            try: await app.send_message('mine_EVO_gold_bot', "‚õè –ö–æ–ø–∞—Ç—å")
            except errors.flood_420.FloodWait as s:
                try: await asyncio.sleep(s)
                except: await asyncio.sleep(1)
                await app.send_message('mine_EVO_gold_bot', "‚õè –ö–æ–ø–∞—Ç—å")
            await asyncio.sleep(await app.db.get(M, 'delay', 3)) 
        else: return

# –∞—Ç–∞–∫–∞
async def attacker(app):
    while True:
        if await app.db.get(M, 'atc', False):
            app.print('–∞—Ç–∫')

            try: await app.send_message('mine_EVO_bot', "–∞—Ç–∫")
            except errors.flood_420.FloodWait as s:
                try: await asyncio.sleep(s)
                except: await asyncio.sleep(1)
                await app.send_message('mine_EVO_bot', "–∞—Ç–∫")
            await asyncio.sleep(await app.db.get(M, 'atc_delay', 3)) 
        else: return

# –∫–æ–ª-–≤–æ —Ç–æ–ø–ª–∏–≤–∞ –≤ –±—É—Ä–µ
async def check_fuel(app):
    for _ in range(10):
        bur_msg = await make_request(app, "–±—É—Ä", "mine_evo_bot", startswith='üöß –ê–≤—Ç–æ–±—É—Ä –∏–≥—Ä–æ–∫–∞', timeout=10)
        if bur_msg is None:
            await asyncio.sleep(10)
            continue
        st = bur_msg.text.split()
        return int(st[ st.index('—Å–∫–ª–∞–¥–µ:') + 1 ])
    
# –∞–≤—Ç–æ –∞–≤—Ç–æ-–±—É—Ä
async def start_autobur(app):
    app.print("–ü–æ–ø–æ–ª–Ω—è—é –±—É—Ä –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤")
    while True:
        if await check_fuel(app) == 0:
            for _ in range(10):
                new_fuel_msg = await make_request(app, "–∫–∞—á", "mine_evo_bot", startswith='üõ¢ –ë–æ—á–∫–∞ —Ç–æ–ø–ª–∏–≤–∞', timeout=10)
                if new_fuel_msg is None:
                    await asyncio.sleep(10)
                    continue
                if new_fuel_msg.text.startswith('‚ùóÔ∏è–í –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–∏ –∫–æ–Ω—á–∏–ª–∞—Å—å –Ω–µ—Ñ—Ç—å!'):
                    break
            
        bur_msg = await make_request(app, "–±—É—Ä", "mine_evo_bot", timeout=10)
        if bur_msg is None:
            await asyncio.sleep(10)
            continue
        await app.request_callback_answer(
            bur_msg.chat.id, bur_msg.id,
            callback_data=f"am_refuel:am_refuel:{app.me.id}"
        )
        await asyncio.sleep(60*60*12)


# –Ω–∞—á–∞—Ç—å –∫–æ–ø–∞—Ç—å
@cmd(['mdig'])
async def _dig(app, msg):
    if await app.db.get(M, 'work', False):
        await msg.edit("‚ùé –Ø –∏ —Ç–∞–∫ –∫–æ–ø–∞—é")
        return
    
    await app.db.set(M, 'work', True)

    await msg.edit("‚úÖ –∫–æ–ø–∞—é")
    await digger(app)
    
# –∑–∞–∫–æ–Ω—á–∏—Ç—å –∫–æ–ø–∞—Ç—å
@cmd(['mstopdig', 'mnodig', 'mundig'])
async def _stopdig(app, msg):
    if not await app.db.get(M, 'work', False):
        return await msg.edit(f'‚ùé –∞ —è –∏ –Ω–µ –∫–æ–ø–∞—é')

    await app.db.set(M, 'work', False)

    c = await app.db.get(M, 'c', 0)
    await msg.edit(f'‚ùé –Ω–µ –∫–æ–ø–∞—é. –£—Å–ø–µ–ª –∫–æ–ø–Ω—É—Ç—å {b(c)} {b(plural(c, plural_raz))}')

    await app.db.set(M, 'c', 0)
    await app.db.delete(M, 'stats')

# –∑–∞–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫–æ–ø–∫—É
@cmd(['mdelay'])
async def _mdelay(app, msg):
    try:
        delay = float(msg.text.split(maxsplit=1)[-1])
        await app.db.set(M, 'delay', delay)
        await msg.edit(
            f"–ó–∞–¥–¥–µ—Ä–∂–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ {delay}\n"
            f"–¢–∞–∫–∏–º —Ç–µ–º–ø–æ–º\n"
            f"–∑–∞ {b('—á–∞—Å')} —Ç—ã –≤—Å–∫–æ–ø–∞–µ—à—å {b(f'{60*60/delay:,.0f}')} —Ä–∞–∑\n"
            f"–∑–∞ {b(f'–¥–µ–Ω—å {  60*60*24  /delay:,.0f}'    )} —Ä–∞–∑\n"
            f"–∑–∞ {b(f'–Ω–µ–¥–µ–ª—é {60*60*24*7/delay:,.0f}')} —Ä–∞–∑\n"
        )
    except:
        await msg.edit('–æ—à–∏–±–∫–∞')

# –∑–∞–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∞—Ç–∞–∫—É
@cmd(['matcdelay'])
async def _matcdelay(app, msg):
    try:
        delay = float(msg.text.split(maxsplit=1)[-1])
        await app.db.set(M, 'atc_delay', delay)
        await msg.edit(
            f"–ó–∞–¥–¥–µ—Ä–∂–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ –∞—Ç–∞–∫—É: {delay}\n"
        )
    except:
        await msg.edit('–æ—à–∏–±–∫–∞')

# –ø—Ä–µ—Ñ–∏–∫—Å—ã –¥–µ–Ω–µ–≥
pref = {
    'K':  10**(3*1),
    'M':  10**(3*2),
    'B':  10**(3*3),
    'T':  10**(3*4),
    'Qa': 10**(3*5),
    'Qi': 10**(3*6),
    'Sx': 10**(3*7),
    'Sp': 10**(3*8),
    'O':  10**(3*9),
    'N':  10**(3*10),
    'D':  10**(3*11),
    "Aa": 10**(3*12),
    "Bb": 10**(3*13),
    "Cc": 10**(3*14),
    "Dd": 10**(3*15),
    "Ee": 10**(3*16),
    "Ff": 10**(3*17),
    "Gg": 10**(3*18),
    "Hh": 10**(3*19),
    "Ii": 10**(3*20),
    "Jj": 10**(3*21),
    "Kk": 10**(3*22),
    "Ll": 10**(3*23),
    "Mm": 10**(3*24),
    "Nn": 10**(3*25),
    "Oo": 10**(3*26),
    "Pp": 10**(3*27),
    "Qq": 10**(3*28),
    "Rr": 10**(3*29),
    "Ss": 10**(3*30),
    "Tt": 10**(3*31),
    "Uu": 10**(3*32),
    "Vv": 10**(3*33),
    "Ww": 10**(3*34),
    "Xx": 10**(3*35),
    "Yy": 10**(3*36),
    "Zz": 10**(3*37)
}


# –æ—Ç–ø—Ä–∞–∫–∞ –ª–∏–º–∏—Ç–æ–≤
# @cmd(['send'])
async def _send(app, msg):
    _, nickname, count, val = msg.text.split(maxsplit=3)
    count = int(count)
    to_send = parse_amout(val, pref) / (1 - .1), 2
    await msg.edit(
        f"üí≤ –ø–µ—Ä–µ–≤–æ–¥ –∏–≥—Ä–æ–∫—É {code(nickname)}\n"
        f"{code(count)} —Ä–∞–∑ –ø–æ {code(val)}.\n"
        f"–° —É —á—ë—Ç–æ–º –∫–æ–º–∏—Å–∏–∏: {code(round(to_send, 2))}\n"
        f"–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏: {b(count * 2)} —Å.\n"
        f"–∏–ª–∏ {b(round(count * 2 / 60, 2))} –º.\n"
        f"–∏–ª–∏ {b(round(count * 2 / 60 / 60, 2))} —á."
    )

# –æ—Ç–∫—Ä—ã–≤–∞–Ω–∏–µ –∫–µ–π—Å–æ–≤
@cmd(["mopen", "mcase", '–º–æ', '–º–æ—Ç–∫', '–º–æ—Ç–∫—Ä—ã—Ç—å'])
async def _open(app, msg):
    try:
        _, *values = msg.text.split()

        if len(values) % 2 != 0:
            raise ValueError()

        await msg.edit(f"üì§ –æ—Ç–∫—Ä—ã–≤–∞—é {f', '.join([f'{values[i]} {values[i + 1]}' for i in range(0, len(values), 2)])}")

        for amout, case_type in [(values[i], values[i + 1]) for i in range(0, len(values), 2)]:
            await asyncio.sleep(2)

            try: amout = int(amout)
            except ValueError:
                amout, case_type = case_type, amout
                amout = int(amout)

            caselim = await app.db.get(M, 'caselim', 20)

            groups = [*[caselim]*(amout//caselim), amout%caselim]
            try: groups.remove(0)
            except: pass

            for am in groups:
                await asyncio.sleep(2)
                await app.send_message(msg.chat.id, f"–æ—Ç–∫—Ä—ã—Ç—å {case_type} {am}")

    except (IndexError, ValueError) as e: 
        print(e)
        await msg.edit(
            f"–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö!"
        )

# —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–æ–≤ –∑–∞ —Ä–∞–∑
@cmd(['–º–æ—Ç–∫–ª', 'mopenlim'])
async def _mopenlim(app, msg):
    try:
        lim = int(msg.text.split(maxsplit=1)[-1])
        await app.db.set(M, 'caselim', lim)
        await msg.edit(b("–ì–æ—Ç–æ–≤–æ!"))
    except IndexError:
        return await msg.edit(b('–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö!'))

# –¥–æ–ø —Ñ—É–Ω–∫—Ü–∏—è. –†–µ–∂–µ—Ç —Å—Ç—Ä–æ–∫—É –¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
split_to = lambda text, to=None: text if to is None else (text+' ')[:text.find(to)]

# –µ–º–æ–¥–∑–∏
SAD = '<emoji id=5319007148565341481>‚òπÔ∏è</emoji>'
LOADING = '<emoji id=5821116867309210830>‚è≥</emoji>'

# —à–∞–±–ª–æ–Ω –¥–ª—è .evo –∏ .bevo
layout = (''
    + b("–ó–∞–ø—Ä–æ—Å:") + "\n"
    + bq('{0}') + "\n"
    + b("–û—Ç–≤–µ—Ç –ë–æ—Ç–∞:") + "\n"
    + bq('{1}')
)

# –∑–∞–ø—Ä–æ—Å –±–æ—Ç—É
@cmd('evo')
async def _evo(app, msg):
    await msg.edit(f'{LOADING} –ó–∞–≥—Ä—É–∑–∫–∞...')
    query = msg.text.split(maxsplit=1)[1]
    answer = await make_request(app, query, WORKER_CHAT, timeout=10)
    await msg.edit(f"{SAD} –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª" if answer is None else layout.format(query, answer.text.html),
        disable_web_page_preview=True
    )

# –∑–∞–ø—Ä–æ—Å –±–æ—Ç—É –≤ –õ–°
@cmd('bevo')
async def _bevo(app, msg):
    await msg.edit(f'{LOADING} –ó–∞–≥—Ä—É–∑–∫–∞...')
    query = msg.text.split(maxsplit=1)[1]
    answer = await make_request(app, query, 'mine_evo_bot', timeout=10)
    await msg.edit(f"{SAD} –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª" if answer is None else layout.format(query, answer.text.html),
        disable_web_page_preview=True
    )

# –ø–æ–∫–∞–∑–∞—Ç—å –∫–µ–π—Å—ã
@cmd(['mcases', '–º–∫', '–º–∫–µ–π—Å—ã'])
async def _cases(app, msg):
    await msg.edit(f'{LOADING} –ó–∞–≥—Ä—É–∑–∫–∞...')
    answer = await make_request(app, '–∫–µ–π—Å—ã', WORKER_CHAT, 'üì¶ –ö–µ–π—Å—ã –∏–≥—Ä–æ–∫–∞', 10)
    await msg.edit(
        f"{SAD} –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª" if answer is None else split_to(split_to(answer.text.html, 'üî•'), '–û—Ç–∫—Ä—ã—Ç—å'),
        disable_web_page_preview=True
    )

# –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
@cmd(['mprof', 'mp', '–º–ø', '–º–ø—Ä–æ—Ñ', '–º–ø—Ä–æ—Ñ–∏–ª—å'])
async def _prof(app, msg):
    await msg.edit(f'{LOADING} –ó–∞–≥—Ä—É–∑–∫–∞...')
    answer = await make_request(app, '–ø—Ä–æ—Ñ–∏–ª—å', WORKER_CHAT, '–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 10)
    await msg.edit(f"{SAD} –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª" if answer is None else split_to(answer.text.html, 'üî•'),
        disable_web_page_preview=True
    )

# –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É
@cmd(['mstat', 'ms', 'mstats', '–º—Å—Ç–∞—Ç–∞', '–º—Å—Ç–∞—Ç', '–º—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'])
async def _stat(app, msg):    
    await msg.edit(f'{LOADING} –ó–∞–≥—Ä—É–∑–∫–∞...')
    answer = await make_request(app, '—Å—Ç–∞—Ç–∞', WORKER_CHAT, '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 10)
    await msg.edit(f"{SAD} –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª" if answer is None else answer.text.html,
        disable_web_page_preview=True
    )


# –∞–≤—Ç–æ –∞—Ç–∞–∫–∞ –±–æ—Å—Å–∞
@Client.on_message(
    filters.chat('mine_evo_bot') &
    filters.user('mine_evo_bot') &
    filters.regex('üî∂ –¢—ã –≤—ã–±—Ä–∞–ª –±–æ—Å—Å–∞: .*')
)
async def _boss(app, _):    
    await app.send_message(LOG_CHAT, "–ë—å—é –±–æ—Å—Å–∏–∫–æ–≤")
    
    await app.db.set(M, 'atc', True)
    
    await attacker(app)
      
# –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–∞—Ç–∞–∫–∏  
@Client.on_message(
    filters.chat('mine_evo_bot') &
    filters.user('mine_evo_bot') &
    filters.regex(".*–¥–ª—è –∞—Ç–∞–∫–∏ –≤—ã–±–µ—Ä–∏ –±–æ—Å—Å–∞\!.*")
)       
async def _stopboss(app, _):
    await app.db.set(M, 'atc', False)
    await app.send_message(LOG_CHAT, "–ó–∞–∫–æ–Ω—á–∏–ª –±–∏—Ç—å –±–æ—Å—Å–∞")

# –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞—Ö—Ç—ã
@Client.on_message(
    filters.chat('mine_evo_bot') &
    filters.user('mine_evo_bot') &
    filters.regex('üîì –û—Ç–∫—Ä—ã—Ç–∞ –Ω–æ–≤–∞—è —à–∞—Ö—Ç–∞')
    ,
    group=get_group()
)
async def _new_cave(app, msg):
    await app.send_message('mine_evo_bot', msg.text[23:])

# –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ø–∫–∏
@Client.on_message(
    filters.chat(['mine_evo_bot', 'mine_evo_gold_bot']) &
    filters.user(['mine_evo_bot', 'mine_evo_gold_bot']) &
    filters.regex("–†—É–¥–∞ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å")
    , group=get_group()
)
async def _dig_ore(app, msg):
    t, th = msg.text, msg.text.html
    """
    üéÜ  <b><i>–ü–ª–∞–∑–º–∞ +1</i></b> 

    ‚õè <b>–ú–∞—Ç–µ—Ä–∏—è II</b>  +<b>16.60Qi –µ–¥.</b> 
    <b><i>–†—É–¥–∞ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å :  100%  /  100%</i></b>
    """
    plasma, ore_type, ore_count = 0, '', 0
    s = BeautifulSoup(th, 'html.parser')
    if "–ü–ª–∞–∑–º–∞" in t:
        plasma = int(s.find('i').text[8:])

    ore_type = s.find_all('b')[-3].text
    ore_str_count = s.find_all('b')[-2].text
    ore_count = int(parse_amout(ore_str_count, pref))
    
    # app.print(f"–≤—ã–æ–∫–æ–ø–∞–ª {plasma = } | {ore_type = } | {ore_str_count = } | {ore_count = }")

    d = await app.db.get(M, 'stats', {})

    # app.print('–í—Å–µ–≥–æ' + str(d))

    ores = d.get('ores', {})
    ores[ore_type] = ores.get(ore_type, 0) + ore_count

    await app.db.set(M, 'stats', dict(
        plasma = d.get('plasma', 0) + plasma,
        ores = ores
    ))


    d = await app.db.get(M, 'stats_all', {})

    # app.print('–í—Å–µ–≥–æ –≤–æ–æ–±—â–µ ' + str(d))

    ores = d.get('ores', {})
    ores[ore_type] = ores.get(ore_type, 0) + ore_count

    await app.db.set(M, 'stats_all', dict(
        plasma = d.get('plasma', 0) + plasma,
        ores = ores
    ))


    await app.db.set(M, 'c',
        (await app.db.get(M, 'c', 0)) + 1
    )

    await app.db.set(M, 'all_c',
        (await app.db.get(M, 'all_c', 0)) + 1
    )
    
# –ª–æ–≥ –∫–µ–π—Å–æ–≤, –±–æ—Å—Å–æ–≤
@Client.on_message(
    filters.chat(['mine_evo_bot', 'mine_evo_gold_bot']) &
    filters.user(['mine_evo_bot', 'mine_evo_gold_bot']) & (
        filters.regex('[‚ú®|üòÑ|üì¶|üßß|‚úâÔ∏è|üåå|üíº|üëú|üó≥|üïã|üíé|üé≤].*–ù–∞–π–¥–µ–Ω.*') |
        filters.regex('‚ö°Ô∏è.*–Ω–∞—à–µ–ª\(–ª–∞\).*') |
        filters.regex('üéâ –ë–æ—Å—Å')
    ),
    group=get_group()
)
async def _find_cases(_, msg):
    await msg.copy(LOG_CHAT)
